# 动态SQL语句

## 简介

1. 简化了拼装SQL语句的操作



## if  where

1. ==if==：用于简单的判断

2. ==where==：用于添加SQL语句中的where关键字，以及去除条件判断后多余的and或or

   ```xml
   // 根据eid,ename, age, sex,多条件查询员工的信息
   // mapper接口
   List<Emp> getEmpListByMultiter(Emp emp);
   // 对应的SQL映射
   <select id="getEmpListByMultiter" resultType="Emp">
       select eid, ename, age, sex from emp
       <where>
           <if test="eid != null">
               and eid = #{eid}
           </if>
           <if test="ename != null and ename != ''">
               and ename = #{ename}
           </if>
           <if test="age != null">
               and age = #{age}
           </if>
           <if test="sex == 1 or sex == 2">
               and sex = #{sex}
           </if>
       </where>
   </select>
   ```

## trim

1. 用于在条件判断完的SQL语句前后==添加或去除==指定的字符

2. ==prefix==：添加前缀

3. ==prefixoverrides==：去除前缀

4. ==suffix==：添加后缀

5. ==suffixoverrides==：去除后缀

   ```xml
   // 根据eid,ename, age, sex,多条件查询员工的信息
   // mapper接口
   List<Emp> getEmpListByMultiter(Emp emp);
   // 对应的SQL映射
   <select id="getEmpListByMultiter" resultType="Emp">
       select eid, ename, age, sex from emp
       <trim prfix="where" suffixoverrides="and|or">
           // 如果eid不为空，则执行该语句
           <if test="eid != null">
               eid = #{eid} and
           </if>
           <if test="ename != null and ename != ''">
               ename = #{ename} and 
           </if>
           <if test="age != null">
               age = #{age} and 
           </if>
           <if test="sex == 1 or sex == 2">
               sex = #{sex} and 
           </if>
       </where>
   </select>
   ```

## choose（when，otherwise）

1. 主要用于分支判断，类似于switch语句，只执行一条分支SQL语句

2. ==when==：满足条件执行并跳出

3. ==otherwise==：其他情况下执行

   ```xml
   // 根据eid ,eanem, age, sex中的其中一个查询一个员工信息
   List<Emp> getEmpListByChoose(Emp emp);
   // 映射文件
   <select id="getEmpListByChoose" resultType="Emp">
       select eid, ename, age, sex from emp
       where
       // 选择某一个when或otherwise执行
       <choose>
           // eid不为空，则执行该条语句，执行完跳出
           <when test="eid != null">
               eid = #{eid}
           </when>
           <when test="ename != null and ename = ''">
               ename = #{ename}
           </when>
           <when test="age != null">
               age = #{age}
           </when>
           // 以上条件都不满足，则执行该条语句
           <otherwise>
               sex = #{sex}
           </otherwise>
       </choose>
   </select>
   ```

## foreach

1. foreach主要用于数组或集合进行遍历

   1. ==collection==：指定要遍历的集合或数组
   2. ==item==：为遍历的元素设置别名
   3. ==open==：添加循环体的开始内容
   4. ==close==：添加循环体的结束内容
   5. ==separator==：添加每一次循环之间的分隔符
   6. ==index==：若遍历的是list, index代表下标；若遍历的是map, index代表键

2. 批量删除

   ```xml
   通过员工id批量删除员工
   // mapper接口
   void deleteMoreByList(@Param("eids")List<Integer> eids);
   // 对应映射文件
   <delete id="deleteMoreByList">
         delete from emp where eid in
         <foreach collection="eids" item="eid" separator="," open="(" close=")">
             #{eid} //等价于（eid,eid,...)
         </foreach>
     </delete>
   ```

3. 批量添加

   ```xml
   // mapper接口,批量添加员工
   void insertmorebylist(@param(emps) emp[] emps)
   // 对应映射文件
   <insert id="insertmorebylist">
       insert into emp values
       <foreach collection="emps" item="emp">
       	(null,#{emp.ename},#{emp.age}....)
       </foreach>
   </insert>
   // 添加传入参数的值
   emp[] emps = {emp1,emp2...}
   ```

4. 批量修改

   1. 会修改为相同的内容，
   2. 不同内容需要多条批量修改的SQL语句，需要在配置文件中的url添加==*allowMultiQueries=true*==

## SQL

1. 用于设置一段SQL语句，即公共的SQL，可以被同一映射文件中的所有SQL语句引用

   ```xml
   // 添加SQL,取别名
   <sql id="SQLmini" >
       select eid, ename, age, sex from emp
   </sql>
   // 通过别名SQLmini引用SQL
   <include refid="SQLmini"></include>
   ```

   



