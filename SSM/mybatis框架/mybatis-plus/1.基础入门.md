# MyBatis-Plus

## 简介

1. mybatis通过SQL语句操作数据库，必须写大量的xml文件，Mybatis-Plus（简称MP）是一个 Mybatis 的增强工具，它已经封装好了一些crud方法，我们不需要再写xml了，直接调用这些方法就行

## 基础环境配置

1. 添加依赖

   ```xml
   <dependency>
       <groupId>com.baomidou</groupId>
       <artifactId>mybatis-plus-boot-starter</artifactId>
       <version>3.1.2</version>
   </dependency>
   ```

2. 配置数据源

   ```yaml
   spring:
     datasource:
       driver-class-name: com.mysql.cj.jdbc.Driver
       username: root
       password: root
       url: jdbc:mysql://localhost:3306/test?serverTimezone=CTT&useUnicode=true&characterEncoding=utf-8&allowMultiQueries=true
   ```

3. 新建实体类

   **mp常用注解**

   | name                | explanation                                    |
   | ------------------- | ---------------------------------------------- |
   | @Table              | ==实体类名==和数据库表名不相同时使用，指定表名 |
   | @TableId            | 指定主键名称、主键策略                         |
   | @TableField/@column | 实体类中的==成员名称==和表中字段名称不一致     |

   

4. 新建mapper接口继承basemapper

   ```Java
   public interface UserMapper extends BaseMapper<User> {
   }
   ```

5. 在启动类添加扫描，扫描mapper接口

   ```java
   @MapperScan("mapper接口路径")
   @SpringBootApplication
   public class MybatisPlusDemoApplication {
   
       public static void main(String[] args) {
           SpringApplication.run(MybatisPlusDemoApplication.class, args);
       }
   }
   ```

6. 编写测试类

   ```Java
   @RunWith(SpringRunner.class)
   @SpringBootTest
   public class MybatisPlusDemoApplicationTests {
   
       @Resource
       private UserMapper userMapper;
       
       @Test
       public void select(){
           List<User> users = userMapper.selectList(null);
           users.forEach(System.out::println);
       }
   }
   ```

## 基本crud

1. insert(entity)插入：

   ```Java
   public void testInsert(){
       	// 创建一个对象
           Employee employee = new Employee();
       	// 初始对象
           employee.setLastName("东方不败");
           employee.setEmail("dfbb@163.com");
           employee.setGender(1);
           employee.setAge(20);
       	// 插入对象
           emplopyeeDao.insert(employee);
       	// 插入对象，没有传值则插入null值
       	 emplopyeeDao.insertAllColumn(employee);
           //mybatisplus会自动把当前插入对象在数据库中的id写回到该实体中
           System.out.println(employee.getId());
       }
   ```

2. update更新

   1. updateById(entity)：没有传值的字段不会进行更新，要求不能使用get、set方法。否则添加所有参数进行
   2. updateAllColumnById(entity)：会更新所有的字段，没有传值则更新为null

   ```Java
   public void testUpdate(){
           Employee employee = new Employee();
           employee.setId(1);
           employee.setLastName("更新测试");
       
           //根据id进行更新，没有传值的属性就不会更新
       	emplopyeeDao.updateById(employee);
       	//根据id进行更新，没传值的属性就更新为null
           emplopyeeDao.updateAllColumnById(employee);
   }
   ```

3. select查询

   1. selectById(id)：根据id查询

      ```java
      Employee employee = basemapper.selectById(id);
      ```

   2. selectOne(entity)：根据条件查询一条数据

      ```Java
      Employee employeeCondition = new Employee();
      employeeCondition.setId(1);
      employeeCondition.setLastName("更新测试");
      //若是数据库中符合传入的条件的记录有多条，那就不能用这个方法，会报错
      Employee employee = basemapper.selectOne(employeeCondition);
      // 这个方法的sql语句就是where id = 1 and last_name = 更新测试
      ```

   3. selectByMap(Map)：根据查询条件返回多条数据

      ```Java
      Map<String,Object> columnMap = new HashMap<>();
      columnMap.put("last_name","东方不败");//写表中的列名
      columnMap.put("gender","1");
      List<Employee> employees = basemapper.selectByMap(columnMap);
      // columnMap，写的是数据表中的列名，而非实体类的属性名。
      ```

   4. selectBatchIds(List)：通过id列表批量查询

      ```Java
      List<Integer> idList = new ArrayList<>();
      idList.add(1);
      idList.add(2);
      idList.add(3);
      List<Employee> employees = basemapper.selectBatchIds(idList);
      System.out.println(employees);
      ```

4. delete删除

   1. deleteById(id)：根据id删除

      ```java
      basemapeer.deleteById(id);
      ```

   2. deleteByMap(map)：根据条件删除

      ```Java
      Map<String,Object> columnMap = new HashMap<>();
      columnMap.put("gender",0);
      columnMap.put("age",18);
      basemapeer.deleteByMap(columnMap);
      ```

   3. deleteBatchIds(List)：根据id批量删除

      ```Java
      List<Integer> idList = new ArrayList<>();
       idList.add(1);
       idList.add(2);
       basemapeer.deleteBatchIds(idList);
      ```

5. MP启动注入SQL现象

   1. 包含关系：basemapper->mapperproxy->sqlsession->sqlsessionFactory->configuration->mapperstatements
   2. 每一个mapperstatements都表示mapper接口中的一个方法与其对应的mapper映射文件
   3. MP启动时，会逐个分析mapper接口中的方法，生成对应sql，保存到mapperstatements

6. 总结：basemapper提供了大量的操作数据库方法，囊括了crud的单一、批量操作

