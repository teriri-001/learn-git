# springboot配置

## 配置文件

**文件命名**

springboot使用一个全局配置文件，配置文件名是固定的

* application.properties

* application.yml

  

**配置文件作用**

修改springboot自动配置的默认值



**文件存放位置**

* 直接放在resources目录下（优先级最低）
* 放在resources目录下新建一个config目录放置（3）
* src同级目录下新建config目录存放（1）
* 直接放在src目录下（2）



---

## yaml语法

**yaml基本规则**

* 使用缩进表示层级关系
* 缩进时不允许使用Tab键，只允许使用空格
* 缩进的空格数目不限制，只要是相同的缩进数，就表示相同的层级
* 区分大小写



**yaml基本语法**

* `key:(空格)value`：表示一对键值对，**必须有空格**



**值的写法**

* 普通的值

  ```yaml
  # 直接写值
  # 字符串默认不用加上引号（单引号、双引号），引号有其他的作用
  # 双引号：特殊字符会进行转义
  # 单引号：特殊字符不会进行转义
  k: v
  sliever:
     port: 8081
  ```

* 对象、Map：

  ```yaml
  # 对象名
  frinds:
  # 对象属性
     lastName: sinon
     age: 18
  # 行内写法
  frinds: {lastName: sinon,age: 18}
  ```

* 数组（list、set）：

  ```yaml
  # 用“- 值” 表示数组中的一个元素
  pets：
   - cat
   - dog
   - pig
  # 行内写法
  pets: [cat,dog,pig]
  ```



**使用配置文件给属性赋值**

* 编写实体类，并在配置文件中以相同属性进行传值，使用注解指定配置文件块

* 使用`@configurationProPerties(prefix = "类名")`赋值，需要添加`@componet`注解

  ```Java
  /**
  * 将本类中的所有属性和配置文件中的相关的配置进行绑定
  * prefix = “指定要绑定的配置文件中的相关配置”
  ```

* 建议导入配置文件处理器依赖，配置文件进行绑定就会有提示

  ```Java
  @Component
  @ConfigurationProperties(prefix = "person")
public class Person {
      private String lastName;
      private int age;
      private Date birth;
      private Map<String,Object> maps;
      private List<Object> lists;
      private Pet pet;
  }
  ```

* 使用`@value`注解为每一个属性单独赋值

  ```Java
  // 给属性直接赋值：dog1
  @value("dog1")
  private String lastName;
  
  // 给属性赋值配置文件中的值
  @value("${lastName}")
  private String lastName;
  
  //总结@value可添加：直接赋值/${key}从环境变量、配置文件中赋值/#{spel}
  ```

* 两种方法对比
  * 前者支持松散绑定：last-name可以和lastName匹配
  * 前者是批量赋值，后者单个赋值
  * 前者支持JSR303数据校验，后者不支持
  * 前者不支持spel，后者支持
  * 前者支持复杂数据类型，后者不支持（如map、list等）
* JSR303数据校验
  * 校验输入属性值格式是否是声明所需要的格式，注解标注在属性上
  * 使用@Validated注解标识使用数据校验，使用各种数据格式注解标识所需要的数据格式



**@propertySoure、@ImportResource**

* `@configurationProPerties`默认从全局配置文件中获取值，而一般不会把所有的东西都放在全局配置文件中
* 所以，添加别的yaml配置文件，并使用`@propertySoure`注解读取
* `ImportResource`导入spring的xml配置文件
* 在springboot中推荐使用配置类添加配置



**配置文件占位符**

* 随机数

  ```Java
  // 获取10以内的int类型数值
  ${random.int(10)}
  ```

* 占位符获取之前配置的值

  ```java
  // 以前面的person配置为例
  name=${person.lastName}
  ```



---

## 多环境配置

springboot支持多环境配置，并通过激活指定参数等方式快速切换环境

* 多环境配置形式：`application-{profile}.yaml`

  ```java
  // 示例,测试环境
  application-test.yaml
  // 开发环境
  application-dev.yaml
  ```

* 激活方式

  ```yaml
  spring:
   profiles:
    active: {profile}
    # 激活测试环境示例
    active: test
  ```

* yaml多文档块方式

  * 在一个文件中，以`---`划分多个不同的文档块

  * 每一个文档块相当于一种环境配置文件，使用`server.profiles=环境标识`进行区分

    ```yaml
    server:
     port: 8081
    # 在这选择需要激活的文档块,选择激活开发环境，不激活则默认使用该文档块的配置
    spring:
     profiles:
      active: dev
    ---
    server:
     port: 8082
    # 指明该文档块为开发环境
    server:
     profiles: dev
    ---
    server:
     port: 8083
    # 指明该文档块为测试环境
    server:
     profiles: test
    ```

    