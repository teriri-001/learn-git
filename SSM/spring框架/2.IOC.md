# IOC

1. **IOC理论**

   ​		IOC（控制反转），即将对象的创建权交给了spring，我们需要的对象由spring帮忙创建，然后供我们使用

   

   ​		IOC是一种设计思想，DI（依赖注入）是实现IOC的一种方法

2. **实现IOC**

   ​		**IOC是spring框架的核心内容**，可以使用xml配置文件配置，可以使用注解，甚至可以零配置（自动装配）实现IOC

   

   ​     Spring容器在初始化时先读取配置文件，根据配置文件或元数据创建将对象存入容器中，程序使用时再从Ioc容器中取出需要的对象

   

    	采用XML方式配置Bean的时候，Bean的定义信息是和实现分离的；而采用注解的方式可以把两者合为一体，Bean的定义信息直接以注解的形式定义在实现类中，从而达到了零配置的目的。

3. **IOC创建对象原理（xml方式）**

   ​	默认使用无参构造来创建对象，因为IOC是通过反射机制实现的而反射方法创建对象本质上是调用了类的无参构造方法

   * 通过有参构造方法来创建对象

     ```xml
     <!--有三种方法，使用比较好理解的一种-->
     <bean id="xxx",class="xxx">
         <!-- 
     		根据参数名字设置
     		多个参数可使用多条标签实现
      	-->
         <constructor-arg name="name",value="xxxx"/>
     </bean>
     ```

     

## 依赖注入

**构造器注入**

​	前文以述，有参，无参构造器注入

**set方式注入**

1. 创建一个包含各种类型的实体类

   ```Java
   // 添加set方法，反射属性注入就是通过调用该方法，无参构造
   public class student{
   	 // 普通类型
   	 private String name;
   	 // 对象
        private Address address;
        private String[] books;
        private List<String> hobbys;
        private Map<String,String> card;
        private Set<String> games;
       // null
        private String wife;
       // 配置类
        private Properties info;
   }
   ```

2. 配置类编写，创建bean，并为属性注入值

   ```xml
   <!-- -->
   <!-- 普通数据类型注入 -->
   <bean id="student" class="com.kuang.pojo.Student">
        <property name="name" value="小明"/>
   </bean>
   
   <!-- bean对象注入 -->
   <bean id="addr" class="com.kuang.pojo.Address">
        <property name="address" value="重庆"/>
   </bean> 
   <bean id="student" class="com.kuang.pojo.Student">
        <property name="address" ref="addr"/>
   </bean>
   
   <!-- 数组注入 -->
   <bean id="student" class="com.kuang.pojo.Student">
      <property name="books">
          <array>
              <value>西游记</value>
              <value>红楼梦</value>
              <value>水浒传</value>
          </array>
      </property>
    </bean>
   
   <!-- 集合(list/set)注入-->
   <property name="games">
        <set或list>
            <value>LOL</value>
            <value>BOB</value>
            <value>COC</value>
        </set或list>
    </property>
   
   <!-- Map注入-->
   <property name="card">
        <map>
            <entry key="中国邮政" value="456456456465456"/>
            <entry key="建设" value="1456682255511"/>
        </map>
    </property>
   
   <!-- null注入-->
   注入空值
   <property name="wife"><null/></property>
   注入空串
   <property name="wife" value=""></property>
   
   <!-- properties配置信息注入-->
   <property name="info">
       <props>
           <prop key="学号">20190604</prop>
           <prop key="性别">男</prop>
           <prop key="姓名">小明</prop>
       </props>
   </property>
   ```

**Bean作用域**

1. **单例模式(singleton)**：相同id多次从容器中取出的是同一个对象(hashcode值相同)，默认使用该模式

   ```xml
   <bean id="student" class="com.kuang.pojo.Student" scope="singleton">
   </bean>
   ```

2. **原型模式(prototype)**

   ```xml
   <bean id="student" class="com.kuang.pojo.Student" scope="prototype">
   </bean>
   ```

3. 其他模式和web相关

   

**Bean的自动装配**

1. spring会在上下文中自动寻找，并自动装配其属性，有三种装配方式
   1. xml显示装配（前文所述）

   2. java中显示装配

   3. **隐式的自动装配**

      自动装配，只是对于对象类型而言（即Bean注入）

2. **xml自动装配**

   1. `autowrited= “byName”`:通过名字匹配，需要Bean的id与属性名相同
   2. `autowrited = byType`：通过类型匹配，要求Bean类型不重复

3. **注解实现自动装配**

   1. 配置框架

      ```xml
      <?xml version="1.0" encoding="UTF-8"?>
      <beans xmlns="http://www.springframework.org/schema/beans"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xmlns:context="http://www.springframework.org/schema/context"
          xsi:schemaLocation="http://www.springframework.org/schema/beans
              https://www.springframework.org/schema/beans/spring-beans.xsd
              <!-- 导入context约束-->
              http://www.springframework.org/schema/context
              https://www.springframework.org/schema/context/spring-context.xsd">
      
          <!-- 开启注解的支持-->
          <context:annotation-config/>
      
      </beans>
      ```

   2. **@autowired**

      * @Autowired是按类型自动装配的，可以添加`@qualifier("name")`指定名字进行匹配
      * 添加在需要自动注入的属性上,也可以添加在set方法上
      * 使用@Autowired注解，可以将User类中的set方法去掉
   * 需要导入 spring-aop的包！
   
3. 实体类内容
   
      ```Java
      public class User {
         @Autowired
         private Cat cat;
         @Autowired
         private Dog dog;
         private String str;
      
         public Cat getCat() {
             return cat;
        }
         public Dog getDog() {
             return dog;
        }
         public String getStr() {
             return str;
        }
      }
   ```
   
4. 配置文件内容
   
      ```xml
      <bean id="dog" class="com.kuang.pojo.Dog"/>
      <bean id="cat" class="com.kuang.pojo.Cat"/>
      <bean id="user" class="com.kuang.pojo.User"/>
   ```
   
   
   
   



