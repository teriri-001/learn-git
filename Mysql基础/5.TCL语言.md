# TCL(事务控制语言)
## 事务
1. 事务概述
    * 一个或一组SQL语句组成一个执行单元，这个执行单元要么全部执行，要么全部不执行。
    * 事务中某一SQL语句执行失败，则整个执行单元将会回滚到初始状态。

2. 存储引擎概述
    * 数据存储在文件或内存中使用的技术
    * 可以使用`show engines`查看支持的存储引擎
    * 默认的innodb引擎支持事务

3. 事务的ACID属性
    * 原子性（Atomicity)
        1. 事务不可分割，事务中的多条语句要么都发生，要么都不发生。
    * 一致性（consistency）
        1. 事务处理前后必须使数据库一致性不变
        2. 如原先两者共100，转账后总和还是100
    * 隔离性（isolation）
        1. 一个事务的执行不能被其他事务干扰，受隔离级别影响
    * 持久性（durability）
        1. 一个事务被提交后，对数据库中数据的改变就是永久性的

4. 事务的创建
    * 隐式事务
        1. 事务没有明显的开启和结束的标记，如insert、update、delete等语句
        2. 因为设置了自动提交的功能，会自动开启和结束事务
    * 显示事务
        1. 需要先将自动提交功能禁用：
            * 查看自动提交状态：`show variables like 'autocommit';`
            * 关闭自动提交：`set autocommit=0;`
            * 关闭只对当前事务有效
        2. 步骤
            1. 关闭自动提交
            2. 开启事务：`start transaction;`
            3. 编写事务中的SQL语句（增删改查：select、update、insert、delete等）
            4. 结束事务：分为提交事务`(commit)`；回滚事务`(rollback)`
            5. 设置保存点`(savapoint a)`搭配回滚使用`(rollback to a)`

5. 事务的并发问题
    * 对于同时运行的多个事务，当事务访问数据相同时，需要采取隔离机制，否则将导致并发问题
    * `脏读`问题：两个事务T1、T2，当T1读取了T2修改但是没有提交的字段后，T2采取回滚，则T1读取的内容就是临时且无效的
    * `不可重复读`问题：由于T1的修改但未提交以及回滚等操作，导致T2两次读取得到了不同的值
    * `幻读`问题：与不可重复读类型，原因是由于行的插入与回滚，导致另一事务两次读到了不同行数

6. 处理事务并发问题（设置事务隔离级别）
    * 查看当前事务隔离级别：`select @@tx_isolation;`

    * `read uncommitted（读未提交）`：脏读、幻读、不可重复读
    * `read committed（读已提交）`：避免脏读
    * `repeatable read（可重复读）`：避免脏读、不可重复读（MySQL默认级别）
    * `serializable（串行化）`：避免脏读、幻读、不可重复读

## 视图(view)
1. 概述
    * 是一个临时虚拟表，通过原始表动态生成的数据，使用时和普通表一样使用
    * 视图中的行和列数据来自自定义视图的查询中使用的表

2. 应用场景
    * 多个地方用到同样的查询结果，且该结果用到的语句较复杂，则可将其封装为视图

3. 视图操作
    * 创建视图：`creat view 视图名 as 查询语句`
    * 修改视图：
        1. `creat or replace view 视图名 as 查询语句`
        2. `alter view 视图名 as 查询语句`
    * 删除视图：`drop view 视图名、视图名.....`
    * 查看视图
        1. `desc ...`
        2. `show create view 视图名`：可以查看创建过程

4. 优势
    * 重用SQL语句
    * 简化SQL语句
    * 保护数据，避免直接操作原始表

5. 视图的更新
    * 不修改视图的SQL逻辑的情况下，更新视图中的数据
    * 可以使用原始表的语法对视图中的数据进行操作，但是对原始表数据有影响，所以建立视图时应设置只读权限
    * 不可更新的视图特点
        1. SQL语句包含特定关键字：having、union等
        2. 常量视图
        3. 包含子查询、多表查询

6. 与表对比
    * 不占内存空间，只保存了SQL逻辑
    * 一般只用于查询