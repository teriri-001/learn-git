# springcloud

## springcloud概述

1. 什么是springcloud
    * 应用层面介绍：
        1. 是一个服务治理平台，提供了一些服务框架：服务注册与发现、配置中心、消息中心、负载均衡、数据监控等
    * 概念定义
        1. SC是一个微服务框架。提供全套的分布式系统解决方案
        2. SC是对微服务基础框架`netfilx`的多个开源组件进行了封装，同时实现了和`云端平台`以及和`springboot开发框架`的集成。
        3. SC为微服务架构开发涉及的：`配置管理，服务治理，熔断机制，智能路由、微代理、控制总线、一次性token、全局一致性锁、leader选举、分布式session、集群状态管理`等提供了简单的开发方式。
        4. SC提供了快速构建分布式系统的工具，可以快速启动服务或构建应用、同时能够快速和云平台资源进行对接。
2. springcloud的位置
    * spring cloud是spring的一个顶级项目，与spring boot位于同一位置
3. spring cloud的子项目 
4. spring cloud版本定义说明
    1. 单词首字母越大表明版本号越大
    2. 使用单词命名的目的在于：更好的管理每个子项目的清单，避免自己版本号与子项目版本号混淆。
    3. 版本发布计划
        * build-xx：开发版
        * GA      ：稳定版，基本可使用
        * PRE     ：里程碑版，修复GA版bug修复。
        * RC      ：候选发布版
        * SR      ：正式发布版
5. 常见版本号说明
    * 软件版本号：2.0.3.RELEASE
        1. 2 --- 主版本号
        2. 0 --- 次版本号
        3. 3 --- 修改版本号
        4. release --- 版本处于的开发阶段（希腊版本号）
6. 常用网站：
    * [中文API文档](https://springcloud.cc/spring-cloud-dalston.html)
    * [springcloud中文网](https://springcloud.cc)
    * [springcloud中国社区](springcloud.cn)



---

## 环境搭建

### 服务提供者

* **创建项目**

  ```xml
  <!-- 新建一个maven项目，去除src文件，只保留pom.xml，为总配置-->
  ```

* **pom.xml配置**

  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
      <modelVersion>4.0.0</modelVersion>
  
      <groupId>com.enn</groupId>
      <artifactId>ues</artifactId>
      <!--项目打包方式-->
      <packaging>pom</packaging>
      <version>1.0-SNAPSHOT</version>
      <!--模块管理，新建module时自动添加-->
      <modules>
          <module>ues-api</module>
          <module>ues-cim</module>
          <module>ues-common</module>
          <module>ues-data-service</module>
          <module>ues-message-cached</module>
          <module>ues-daily</module>
          <module>ues-data-file-service</module>
          <module>ues-pushdata</module>
      </modules>
      <!--引入父项目-->
      <parent>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-starter-parent</artifactId>
          <version>2.2.3.RELEASE</version>
          <relativePath/>
      </parent>
  
      <properties>
          
          <!--依赖的版本管理-->
          <java.version>1.8</java.version>
          	.......
          
      </properties>
  
      <dependencyManagement>
          
          <dependencies>
              <!--添加需要的依赖-->
          </dependencies>
          <!--springcloud依赖、springboot、数据源配置、测试及日志-->
          <dependency>
               <groupId>org.springframework.cloud</groupId>
               <artifactId>spring-cloud-dependencies</artifactId>
              <!--版本号一般不写死-->
               <version>${spring-cloud.version}</version>
               <type>pom</type>
               <scope>import</scope>
          </dependency>
          	........
          
      </dependencyManagement>
  
  </project>
  ```

* **在主项目上新增一个module**

  * 每一个为独立的springboot项目，添加相应的配置、数据库等
  * 需要配置spring项目的名称：`spring.application.name:ues-api`

* **服务提供接口**

  ```Java
  // 新建一个controller接口提供服务
  // 提供restful服务，springcloud服务之间通信是通过http实现的，有restTemplate和feign两种方式
  @RestController
  public class provider{
    
      // 自动注入service层实现
      @autowired
      xxxService xxxservice;
      
      //controller接口，提供具体服务
      @PostMapping("/hello")
      public int adduser(user user){
          int addResult = xxxservice.addUser(user);
          return addResult;
      }
  }
  ```
  



### 服务消费者

* 新建一个模块(module)，添加依赖、配置等信息



* **服务消费接口（RestTemplate方式）**

  * [resttemplate详解](https://www.cnblogs.com/chancy/p/8795334.html)
  
  ```Java
// 消费者处于Controller层
  // 使用restemplate调用服务
  @Autowired
  private RestTemplate restemplate;
  
  // CIM服务的地址
  public static final String url = "http://meta-service.test.fnwintranet.com";
  
  @RequestMapping("/cim/meta/custom/query")
  public void findCimTree(String stationId,String path,String types){
      Map<String,String> map = new hashMap<>();
      map.put("stationId",stationId);
      map.put("path",path);
      map.put("types",types);
      String result = restemplate.getObject
  }
  ```
  
  